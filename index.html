<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOUSE AI | GLOBAL IPTV SYSTEM</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00d2ff;
            --accent: #00ff88;
            --bg-dark: #02040a;
            --panel-bg: #0d1117;
            --text: #e6edf3;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background: var(--bg-dark); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        nav { height: 70px; background: #000; border-bottom: 2px solid var(--primary); display: flex; align-items: center; justify-content: space-between; padding: 0 40px; z-index: 10; }
        .brand { font-family: 'Orbitron'; font-size: 1.8rem; color: var(--primary); letter-spacing: 2px; }
        .status-tag { background: rgba(0, 255, 136, 0.1); color: var(--accent); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .main-wrapper { display: flex; flex: 1; width: 100%; overflow: hidden; }
        .sidebar { width: 350px; background: var(--panel-bg); border-left: 1px solid #30363d; display: flex; flex-direction: column; }
        .control-panel { padding: 20px; background: #161b22; border-bottom: 1px solid #333; }
        .btn-action { width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #000; transition: 0.3s; }
        .search-area { padding: 15px; border-bottom: 1px solid #333; }
        .input-box { width: 100%; padding: 10px; background: #000; border: 1px solid #333; color: white; border-radius: 5px; outline: none; }
        .channel-list { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .channel-item { display: flex; align-items: center; padding: 10px; background: #161b22; border-radius: 8px; cursor: pointer; border: 1px solid transparent; }
        .channel-item:hover { border-color: var(--primary); }
        .channel-item img { width: 40px; height: 40px; border-radius: 5px; margin-left: 12px; object-fit: contain; background: #fff; }
        .content-area { flex: 1; padding: 20px; background: #05070a; display: flex; flex-direction: column; }
        .video-box { flex: 1; background: #000; border-radius: 15px; overflow: hidden; border: 1px solid #333; }
        video { width: 100%; height: 100%; }
        .now-playing { margin-top: 15px; padding: 15px; background: var(--panel-bg); border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        footer { height: 40px; background: #000; border-top: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #8b949e; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    </style>
</head>
<body>

<nav>
    <div class="brand">MOUSE AI <span style="font-size: 0.7rem; opacity: 0.5;">GLOBAL</span></div>
    <div class="status-tag" id="loadStatus">نظام MisterAI جاهز</div>
</nav>

<div class="main-wrapper">
    <aside class="sidebar">
        <div class="control-panel">
            <button class="btn-action" onclick="loadMyServer()"><i class="fas fa-server"></i> تشغيل سيرفر StableChannels</button>
        </div>
        <div class="search-area">
            <input type="text" id="searchInput" class="input-box" placeholder="بحث عن قناة..." onkeyup="filterChannels()">
        </div>
        <div class="channel-list" id="listContainer"></div>
    </aside>

    <main class="content-area">
        <div class="video-box">
            <video id="player" controls autoplay poster="https://wallpaperaccess.com/full/1567831.jpg"></video>
        </div>
        <div class="now-playing">
            <div>
                <h2 id="viewName" style="color: var(--primary); font-size: 1.2rem;">بانتظار اختيار القناة</h2>
                <p id="viewGroup" style="color: var(--accent); font-size: 0.8rem;">نظام مِستر إيه آي</p>
            </div>
            <div id="totalCount" style="color: #8b949e; font-size: 0.8rem;">0 قناة</div>
        </div>
    </main>
</div>

<footer>
    Developed by <b>MUSTAPHA (MisterAI)</b> | 2025
</footer>

<script>
    const CONFIG = {
        host: "http://live.stablechannels.tv:80",
        user: "nfsthbbx",
        pass: "vFf8aZ2n92"
    };

    let allChannels = [];
    const video = document.getElementById('player');
    let hls = null;

    async function loadMyServer() {
        const statusTag = document.getElementById('loadStatus');
        statusTag.textContent = "جاري التحميل...";
        const m3uUrl = `${CONFIG.host}/get.php?username=${CONFIG.user}&password=${CONFIG.pass}&type=m3u_plus&output=ts`;
        const proxyUrl = `/api/proxy?url=${encodeURIComponent(m3uUrl)}`;

        try {
            const response = await fetch(proxyUrl);
            const data = await response.text();
            const lines = data.split('\n');
            allChannels = [];
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF:')) {
                    const name = lines[i].split(',')[1]?.trim() || "قناة غير معروفة";
                    const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "https://cdn-icons-png.flaticon.com/512/716/716429.png";
                    const stream = lines[i+1]?.trim();
                    if (stream && stream.startsWith('http')) {
                        allChannels.push({ name, logo, stream });
                    }
                }
            }
            renderChannels(allChannels);
            statusTag.textContent = "تم التحديث ✅";
            document.getElementById('totalCount').textContent = `${allChannels.length} قناة`;
        } catch (err) {
            statusTag.textContent = "فشل الاتصال ❌";
        }
    }

    function renderChannels(list) {
        const container = document.getElementById('listContainer');
        container.innerHTML = '';
        list.slice(0, 500).forEach(c => {
            const div = document.createElement('div');
            div.className = 'channel-item';
            div.innerHTML = `<img src="${c.logo}"> <b>${c.name}</b>`;
            div.onclick = () => play(c);
            container.appendChild(div);
        });
    }

    function filterChannels() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allChannels.filter(c => c.name.toLowerCase().includes(val));
        renderChannels(filtered);
    }

    function play(c) {
        document.getElementById('viewName').textContent = c.name;
        const finalUrl = `/api/proxy?url=${encodeURIComponent(c.stream)}`;
        
        if (hls) { hls.destroy(); }

        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(finalUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = finalUrl;
            video.play();
        }
    }
</script>
</body>
</html>
